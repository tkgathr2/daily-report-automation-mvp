# 簡単日報くん 使用方法・デプロイ手順書

## 目次

1. [概要](#概要)
2. [初期設定](#初期設定)
3. [デプロイ手順](#デプロイ手順)
4. [使用方法](#使用方法)
5. [トラブルシューティング](#トラブルシューティング)

## 概要

「簡単日報くん」は、Googleカレンダーから今日の予定を取得し、WEBブラウザ上で表示・編集・コピー → Slack送信できるWEBアプリです。

### 機能

- Googleカレンダーから今日の予定を自動取得
- WEBブラウザ上で予定データを編集
- クリップボードにコピー
- Slackチャンネルに投稿

## 初期設定

### 1. GASプロジェクトの準備

1. [Google Apps Script](https://script.google.com/) にアクセス
2. 「新しいプロジェクト」をクリック
3. プロジェクト名を「簡単日報くん」に変更（任意）

### 2. コードファイルの作成

1. `Code.gs` ファイルに `src/Code.gs` の内容をコピー&ペースト
2. 「ファイル」→「新規」→「HTMLファイル」を選択
3. ファイル名を `Index` に設定
4. `Index.html` ファイルに `src/Index.html` の内容をコピー&ペースト

### 3. Slack Webhook URLの取得

1. Slackワークスペースにログイン
2. [Incoming Webhooks](https://api.slack.com/messaging/webhooks) のページにアクセス
3. 「Add to Slack」をクリック
4. 投稿先のチャンネルを選択（後で変更可能）
5. 「Add Incoming Webhooks integration」をクリック
6. 「Webhook URL」をコピー（例：`(YOUR_SLACK_WEBHOOK_URL)`）

### 4. スクリプトプロパティの設定

1. GASエディタで「プロジェクトの設定」（歯車アイコン）をクリック
2. 「スクリプト プロパティ」セクションまでスクロール
3. 「スクリプト プロパティを追加」をクリック
4. プロパティ名：`SLACK_WEBHOOK_URL`
5. 値：コピーしたSlack Webhook URL
6. 「スクリプト プロパティを保存」をクリック

**または、GASエディタで関数を実行して設定する方法：**

1. GASエディタで `setWebhookUrl()` 関数を選択
2. 「実行」ボタンをクリック
3. 関数を実行し、URLを設定するコードを追加して実行（開発者向け）

## デプロイ手順

### 1. WEBアプリとしてデプロイ

1. GASエディタで「デプロイ」→「新しいデプロイ」をクリック
2. 種類の選択で「ウェブアプリ」を選択
3. 設定を入力：
   - **説明**：任意（例：「簡単日報くん v2.0」）
   - **次のユーザーとして実行**：自分
   - **アクセスできるユーザー**：全員（または自分のみ）
4. 「デプロイ」をクリック
5. **初回デプロイ時のみ**：
   - 「承認が必要です」ダイアログが表示される
   - 「許可を確認」をクリック
   - Googleアカウントを選択
   - 「詳細」→「（安全ではないページ）に移動」をクリック（警告が表示される場合）
   - 「許可」をクリックして権限を付与
6. デプロイが完了したら、WEBアプリのURLをコピー

### 2. デプロイ後の確認

1. コピーしたURLにブラウザでアクセス
2. 「簡単日報くん」の画面が表示されることを確認
3. 初回アクセス時、Googleアカウントへのアクセス許可を求められる場合は「許可」をクリック

## 使用方法

### 基本的な使い方

#### 1. 今日の予定を取得

1. WEBアプリのURLにアクセス
2. 「今日の予定を取得」ボタンをクリック
3. テキストエリアに今日のカレンダー予定が表示されます

**表示形式：**
```
・予定タイトル 10:00-11:00
・終日イベント（終日）
・別の予定 14:00-15:00
```

#### 2. 予定データの編集

1. テキストエリアの内容を直接編集できます
2. 追加・削除・変更が可能です
3. 改行も自由に追加できます

#### 3. コピー

1. 「コピー」ボタンをクリック
2. テキストエリアの内容がクリップボードにコピーされます
3. 他のアプリケーション（メール、ドキュメント等）に貼り付け可能です

#### 4. Slackに投稿

1. チャンネル名を入力（例：`#daily-report`）
   - **重要**：`#` から始まる形式で入力してください
2. 「Slackに投稿」ボタンをクリック
3. 送信成功時に「送信成功：Slackに投稿しました。」と表示されます
4. Slackの指定チャンネルで投稿を確認できます

**Slack投稿形式：**
```
【日報】2026/01/11

■ 本日のスケジュール
・予定タイトル 10:00-11:00
・別の予定 14:00-15:00
```

## トラブルシューティング

### 問題：カレンダー予定が取得できない

**原因と対処法：**

1. **カレンダーへのアクセス権限がない**
   - WEBアプリにアクセスした際の権限確認ダイアログで「許可」をクリック
   - GASエディタで「表示」→「ログ」を確認してエラー内容を確認

2. **プライマリカレンダーに予定が存在しない**
   - 今日の日付に予定が存在することを確認
   - 別のカレンダーではなく、プライマリカレンダーに予定があることを確認

### 問題：Slack送信が失敗する

**原因と対処法：**

1. **Webhook URLが設定されていない**
   - GASエディタで「プロジェクトの設定」→「スクリプト プロパティ」を確認
   - `SLACK_WEBHOOK_URL` が正しく設定されているか確認
   - エラーメッセージ：「エラー：Slack Webhook URLが設定されていません。設定を確認してください。」

2. **Webhook URLが無効**
   - SlackでWebhook URLを再作成
   - スクリプトプロパティのURLを更新
   - エラーメッセージ：「エラー：Slack Webhook URLが無効です。設定を確認してください。」

3. **チャンネル名の形式が間違っている**
   - チャンネル名は `#` から始める必要があります（例：`#daily-report`）
   - `#` なしの場合はエラーになります
   - エラーメッセージ：「エラー：チャンネル名が無効です。#から始まる形式で入力してください。」

4. **ネットワークエラー**
   - インターネット接続を確認
   - 時間をおいて再試行
   - エラーメッセージ：「エラー：Slackへの送信に失敗しました。ネットワーク接続を確認してください。」

### 問題：コピー機能が動作しない

**原因と対処法：**

- モダンブラウザ（Chrome、Firefox、Safari、Edge等）を使用しているか確認
- ブラウザの権限設定でクリップボードへのアクセスが許可されているか確認
- フォールバック機能により、テキストエリアを選択してコピーする方法も使用できます

### その他の問題

- **予期しないエラーが発生する**
  - GASエディタで「表示」→「ログ」を確認
  - エラーメッセージの内容を確認
  - ブラウザの開発者ツール（F12）でJavaScriptエラーを確認

## 補足情報

### 対応ブラウザ

- Google Chrome（推奨）
- Firefox
- Safari
- Microsoft Edge

### 権限について

このアプリは以下の権限が必要です：

- **Googleカレンダーへのアクセス**：今日の予定を取得するため
- **スクリプトプロパティへのアクセス**：Webhook URLを保存するため

### 制限事項

- プライマリカレンダーのみ対応（他のカレンダーは対象外）
- 実行当日の予定のみ取得可能
- Slack送信は1回ずつ手動実行

### サポート

問題が解決しない場合は、GASエディタの「表示」→「ログ」でエラー内容を確認してください。
