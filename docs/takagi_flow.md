# Takagi Flow - 開発ワークフローと運用ルール

## 作成日
2026-02-08

## 概要
このドキュメントは、簡単日報くんプロジェクトにおける開発フェーズ（Ask/Plan/Impl/Debug）、チェックポイント、バージョン管理、および運用ルールを定義します。

---

## 1. 開発フェーズ

### 1.1 Takagi Flowの4フェーズ

| フェーズ | 名称 | 目的 | 成果物 |
|:--------:|------|------|--------|
| **Ask** | 要件定義 | 何を作るかを明確にする | 要件定義書（*_requirements_ASK.md） |
| **Plan** | 仕様書作成 | どう作るかを設計する | 仕様書（*_plan.md）、実装コード例 |
| **Impl** | 実装 | コードを書く | 実装済みコード、テスト |
| **Debug** | デバッグ・修正 | 品質を保証する | 動作確認済みシステム |

### 1.2 フェーズの進め方

```
Ask（60点→100点→100点）
  ↓
Plan（60点→100点→100点）
  ↓
Impl（実装・テスト）
  ↓
Debug（動作確認・修正）
  ↓
完了
```

**品質引き上げプロセス**:
- 初版60点版を作成
- レビュー→100点版（1回目）に改善
- 最終レビュー→最終100点版に改善

---

## 2. バージョン別開発ロードマップ（V2〜V7）

### 2.1 バージョン一覧

| バージョン | 機能カテゴリ | 詳細 | 難易度 | 所要時間目安 |
|:----------:|--------------|------|:------:|:------------:|
| **V2** | テンプレート変更＋入力欄追加＋翌日引き継ぎ | 4セクション構成、氏名自動取得、必須バリデーション、「次すること」引き継ぎ | 低 | 2〜3時間 |
| **V3** | ツール連携①（Slack/Gmail/Notion） | 各ツールの履歴を自動取得して「今日やったこと」に表示 | 高 | 4〜6時間 |
| **V4** | ツール連携②（Docs/Drive/Dropbox） | ファイル操作履歴を自動取得 | 高 | 3〜4時間 |
| **V5** | ツール連携③（Zoom/Meet/社内ツール） | 会議参加履歴を自動取得 | 中〜高 | 3〜4時間 |
| **V6** | AIによる自動処理 | 重要度順並べ替え、最大10件絞り込み、削除・編集UI | 高 | 3〜4時間 |
| **V7** | 個人最適化 | ツールON/OFF設定、よく使う順の自動学習 | 中 | 2〜3時間 |

### 2.2 実装順序

```
V2 → V3 → V4 → V5 → V6 → V7
```

**重要**: 各バージョンは前のバージョンが完成していることが前提。

### 2.3 必要な外部設定

| バージョン | 必要な外部設定 |
|:----------:|----------------|
| V2 | なし |
| V3 | Slack追加スコープ、Notion Token |
| V4 | Dropbox Token |
| V5 | Zoom Token、社内ツールエンドポイント |
| V6 | OpenAI API Key |
| V7 | なし |

### 2.4 関連ドキュメント

**要件定義書（Ask）**:
- `docs/specs/V2_requirements_ASK.md` - V2要件定義（最終100点版）
- `docs/specs/V3_requirements_ASK.md` - V3要件定義（最終100点版）
- `docs/specs/V4_requirements_ASK.md` - V4要件定義（最終100点版）
- `docs/specs/V5_requirements_ASK.md` - V5要件定義（最終100点版）
- `docs/specs/V6_requirements_ASK.md` - V6要件定義（最終100点版）
- `docs/specs/V7_requirements_ASK.md` - V7要件定義（最終100点版）

**仕様書（Plan）**:
- `docs/specs/V2_plan.md` - V2仕様書（最終100点版）- 実装コード例あり
- `docs/specs/V3_plan.md` - V3仕様書（最終100点版）- 実装コード例あり
- `docs/specs/V4_plan.md` - V4仕様書（最終100点版）- 実装コード例あり
- `docs/specs/V5_plan.md` - V5仕様書（最終100点版）- 実装コード例あり
- `docs/specs/V6_plan.md` - V6仕様書（最終100点版）- 実装コード例あり
- `docs/specs/V7_plan.md` - V7仕様書（最終100点版）- 実装コード例あり

**Devinタスクファイル**:
- `docs/devin_tasks/V2.md` - V2実装タスク（手順・完了条件）
- `docs/devin_tasks/V3.md` - V3実装タスク（手順・完了条件）
- `docs/devin_tasks/V4.md` - V4実装タスク（手順・完了条件）
- `docs/devin_tasks/V5.md` - V5実装タスク（手順・完了条件）
- `docs/devin_tasks/V6.md` - V6実装タスク（手順・完了条件）
- `docs/devin_tasks/V7.md` - V7実装タスク（手順・完了条件）

---

## 3. 実装チェックポイント（CP-01〜CP-08）

### CP-01: スプレッドシートの初期設定

- [ ] 新しいGoogleスプレッドシートを作成
- [ ] シート①「KPI」を作成し、列ヘッダーを設定（日付、訪問数、架電数、商談数）
- [ ] シート②「DailyReport_Draft」を作成し、列ヘッダーを設定
- [ ] シート③「Config」を作成し、設定項目と設定値を記入
- [ ] テスト用のKPIデータを1行以上入力

### CP-02: GASスクリプトの基本構造作成

- [ ] スプレッドシートにGASスクリプトエディタを開く
- [ ] メイン関数 `generateDailyReport()` を作成
- [ ] 設定読み込み関数 `getConfigValue(key)` を作成
- [ ] カスタムメニューを追加する関数 `onOpen()` を作成
- [ ] スクリプトを保存・実行権限を付与

### CP-03: カレンダー連携実装

- [ ] `getCalendarEvents(date)` 関数を作成
- [ ] Calendar APIを使用して当日の予定を取得
- [ ] `formatScheduleText(events)` 関数でテキストフォーマット
- [ ] テスト：カレンダー予定が正しく取得できることを確認

### CP-04: KPIシート連携実装

- [ ] `getKPIData(date)` 関数を作成
- [ ] KPIシートから該当日の行を検索
- [ ] データが存在しない場合のエラーハンドリング
- [ ] `formatKPIText(kpiData)` 関数でテキストフォーマット
- [ ] テスト：KPIデータが正しく取得できることを確認

### CP-05: 日報下書き生成実装

- [ ] `generateDailyReport()` のメインロジックを実装
- [ ] DailyReport_Draftシートにデータを書き込み
- [ ] 同日の行が存在する場合は上書き処理
- [ ] テスト：日報下書きが正しく生成されることを確認

### CP-06: Slack送信機能実装

- [ ] `formatDailyReportText(rowData)` 関数を作成
- [ ] `sendToSlack(date)` 関数を作成
- [ ] Webhook URLを使用してSlackに投稿
- [ ] 送信成功時に送信済みフラグと送信日時を更新
- [ ] 送信済みフラグチェックを実装
- [ ] テスト：Slack送信が正常に動作することを確認

### CP-07: エラーハンドリング実装

- [ ] カレンダー関連エラーの処理
- [ ] KPIシート関連エラーの処理
- [ ] Slack送信関連エラーの処理
- [ ] Config設定関連エラーの処理
- [ ] すべてのエラーケースをテスト

### CP-08: 統合テスト

- [ ] 正常系テスト（すべてのテスト項目を実行）
- [ ] 異常系テスト（すべてのテスト項目を実行）
- [ ] 受け入れ条件10項目をチェック
- [ ] NG例が発生しないことを確認

---

## 4. 運用ルール

### 4.1 Single Source of Truth

**原則**: 仕様は `docs/plan.md` が唯一の正

- すべての実装は `docs/plan.md` に記載された仕様に基づく
- 仕様変更は必ず `docs/plan.md` を更新してから実装する
- 実装とドキュメントの齟齬を発見した場合は、`docs/plan.md` を基準とする

### 4.2 1機能 = 1PR

**原則**: 小さく分割して実装する

- 1つの機能追加は1つのPRで完結させる
- PRは小さく保ち、レビューしやすくする
- 複数機能の同時実装を避ける

### 4.3 実装管理

- 実装は `docs/devin_tasks/Vxxx.md` で管理する
- 各タスクファイルには手順と完了条件を明記する
- タスク完了後は次のバージョンに進む

### 4.4 変更対象ファイル

| ファイル | 説明 |
|----------|------|
| `src/Code.gs` | バックエンド（GAS） |
| `src/Index.html` | フロントエンド（HTML/CSS/JS） |

**注意事項**:
- V2が最優先: まずV2を完成させてから次のバージョンに進む
- 段階的実装: 1バージョンずつ実装・テスト・完了を確認
- エラーハンドリング: 各ツール連携は独立動作（1つ失敗しても他は動く）
- シークレット管理: API KeyやTokenはScript Propertiesに保存

---

## 5. 関連リソース

- **リポジトリ**: https://github.com/tkgathr2/daily-report-automation-mvp
- **現行MVP**: 完成済み・稼働中

---

以上
