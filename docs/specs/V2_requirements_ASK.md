# V2 要件定義書（Ask）

## ドキュメント情報

| 項目 | 内容 |
|------|------|
| 文書名 | 簡単日報くん V2 要件定義書 |
| バージョン | 3.0（最終100点版） |
| 作成日 | 2026-01-24 |
| 最終更新日 | 2026-01-24 |
| フェーズ | Ask（要件定義）完了 |
| ステータス | 最終100点版 → Plan移行可 |

---

## 1. 目的・背景

### 1.1 目的

現行MVP（カレンダー予定→編集→Slack送信）に対して、
**新テンプレート適用・入力欄追加・翌日引き継ぎ機能**を追加し、
日報の品質と継続性を向上させる。

### 1.2 背景

- 現行MVPは「今日の予定」のみで、振り返りや次のアクションを記録する場所がない
- 日報フォーマットが統一されておらず、必要な情報が抜けることがある
- 「次にやること」が翌日に引き継がれず、タスク漏れが発生する

### 1.3 期待される効果

- 日報の品質向上（必須項目により抜け漏れ防止）
- タスクの継続性向上（翌日引き継ぎ）
- 管理側の把握容易化（統一フォーマット）

---

## 2. 対象機能一覧

| No | 機能ID | 機能名 | 概要 | 難易度 |
|----|--------|--------|------|:------:|
| 1 | F1 | 新テンプレート適用 | 4セクション構成に変更 | 低 |
| 2 | F2 | 氏名の自動取得 | Googleアカウントから取得 | 低 |
| 3 | F3 | 日付形式変更 | 「YYYY年MM月DD日」形式に変更 | 低 |
| 4 | F4 | 必須バリデーション | 各セクション1文字以上で送信可 | 低 |
| 5 | C1 | 「今日やったこと」欄 | 現行のカレンダー予定表示（済） | 済 |
| 6 | C2 | 「わかった事・問題・共有事項」欄 | 人が書く欄を追加 | 低 |
| 7 | C3 | 「売上・利益に関わるポイント」欄 | 人が書く欄を追加 | 低 |
| 8 | C4 | 「次すること」欄 | 人が書く欄を追加 | 低 |
| 9 | D1 | 「次すること」翌日引き継ぎ | 翌日の日報に自動反映 | 中 |

---

## 3. 新テンプレート

### 3.1 フォーマット

```
【YYYY年MM月DD日　氏名　日報】

【今日やったこと】
⚫︎
⚫︎
⚫︎

【わかった事・問題・共有事項】
⚫︎
⚫︎
⚫︎

【売上・利益に関わるポイント】
⚫︎
⚫︎
⚫︎

【次すること】
⚫︎
⚫︎
⚫︎
```

### 3.2 各セクションの役割

| セクション | 役割 | 入力者 | 必須 | 初期値 |
|------------|------|:------:|:----:|--------|
| 今日やったこと | 実際に行った作業の記録 | カレンダー自動＋人 | Yes | カレンダー予定 |
| わかった事・問題・共有事項 | 気づき・問題の早期発見 | 人 | Yes | 空欄 |
| 売上・利益に関わるポイント | 経営に関わる情報の共有 | 人 | Yes | 空欄 |
| 次すること | 翌日以降のタスク | 人 | Yes | 前日の「次すること」（あれば） |

### 3.3 ヘッダーの仕様

| 項目 | 形式 | 例 | 取得元 |
|------|------|-----|--------|
| 日付 | YYYY年MM月DD日 | 2026年01月24日 | システム日時（JST） |
| 氏名 | 表示名またはメール名 | 高木太郎 | Googleアカウント |

### 3.4 画面レイアウト（ワイヤーフレーム）

```
┌─────────────────────────────────────────────────┐
│           簡単日報くん V2                         │
├─────────────────────────────────────────────────┤
│                                                  │
│  【2026年01月24日　高木太郎　日報】              │
│                                                  │
│  [今日の予定を取得] ボタン                       │
│                                                  │
│  ┌──────────────────────────────────────────┐  │
│  │【今日やったこと】                         │  │
│  │ ⚫︎ 顧客訪問 10:00-11:00                  │  │
│  │ ⚫︎ 会議 14:00-15:00                      │  │
│  │ （テキストエリア・編集可能）              │  │
│  └──────────────────────────────────────────┘  │
│                                                  │
│  ┌──────────────────────────────────────────┐  │
│  │【わかった事・問題・共有事項】             │  │
│  │ ⚫︎                                       │  │
│  │ （テキストエリア・編集可能）              │  │
│  └──────────────────────────────────────────┘  │
│                                                  │
│  ┌──────────────────────────────────────────┐  │
│  │【売上・利益に関わるポイント】             │  │
│  │ ⚫︎                                       │  │
│  │ （テキストエリア・編集可能）              │  │
│  └──────────────────────────────────────────┘  │
│                                                  │
│  ┌──────────────────────────────────────────┐  │
│  │【次すること】                             │  │
│  │ ⚫︎ （前日から引き継ぎ or 空欄）          │  │
│  │ （テキストエリア・編集可能）              │  │
│  └──────────────────────────────────────────┘  │
│                                                  │
│  [コピー]  [Slackに投稿]                        │
│                                                  │
│  （メッセージ表示エリア）                        │
│                                                  │
└─────────────────────────────────────────────────┘
```

---

## 4. 前提条件

| No | 前提条件 | 確認方法 |
|----|----------|----------|
| 1 | 現行MVP（V1）が完成・稼働している | 動作確認済み |
| 2 | Googleアカウントでログインしている | Session.getActiveUser()で取得可能 |
| 3 | Slack連携（Webhook）が設定済み | Script Propertiesに設定済み |
| 4 | Script Propertiesが利用可能 | GASの標準機能 |

---

## 5. 受け入れ条件

| No | 受け入れ条件 | 確認方法 |
|----|--------------|----------|
| 1 | 新テンプレート（4セクション構成）で日報が表示される | 画面確認 |
| 2 | ヘッダーに「日付」と「氏名」が自動で入る | 画面確認 |
| 3 | 日付形式が「YYYY年MM月DD日」になっている | 画面確認 |
| 4 | 氏名がGoogleアカウントから自動取得される | 画面確認 |
| 5 | いずれかのセクションが空欄の場合、エラーメッセージが表示される | 送信ボタン押下で確認 |
| 6 | 全セクションに1文字以上入力があれば送信可能 | 送信ボタン押下で確認 |
| 7 | 「次すること」の内容が翌日の日報に自動で表示される | 翌日アクセスで確認 |
| 8 | 翌日引き継ぎされた内容は編集・削除が可能 | 画面操作で確認 |
| 9 | 既存機能（カレンダー取得、コピー、Slack送信）が正常に動作する | 既存テストで確認 |
| 10 | Slack投稿が新テンプレート形式で送信される | Slack画面で確認 |

---

## 6. NG例

| No | NG例 | 理由 | 検出方法 |
|----|------|------|----------|
| 1 | いずれかのセクションが空欄でSlack送信できてしまう | 必須バリデーションが機能していない | テスト |
| 2 | 氏名が空欄または「undefined」で表示される | 自動取得が失敗している | 画面確認 |
| 3 | 日付が「2026/01/24」形式で表示される | 形式変更が適用されていない | 画面確認 |
| 4 | 「次すること」が翌日に引き継がれない | 翌日引き継ぎ機能が動作していない | 翌日テスト |
| 5 | 翌日引き継ぎされた内容が編集できない | UI上の問題 | 画面操作 |
| 6 | 既存のカレンダー取得機能が動かなくなる | 既存機能への影響 | 既存テスト |
| 7 | Slack投稿の形式が崩れる | テンプレート変更の影響 | Slack確認 |
| 8 | 空白文字のみでバリデーションを通過してしまう | トリム処理の不足 | テスト |

---

## 7. 例外ケース

| No | 例外ケース | 発生条件 | 対応方針 | エラーメッセージ |
|----|------------|----------|----------|------------------|
| 1 | Googleアカウント名が取得できない | 権限不足、API制限 | メールアドレスの@前を表示名として使用 | なし（フォールバック） |
| 2 | メールアドレスも取得できない | 権限完全拒否 | 「名前を入力してください」と表示し、手動入力フィールドを表示 | 「氏名を自動取得できませんでした。手動で入力してください。」 |
| 3 | 前日の「次すること」データがない | 初回利用、前日未送信 | 空欄で表示（正常動作） | なし |
| 4 | 前日の「次すること」データが破損 | JSON形式不正 | 空欄で表示し、エラーログを記録 | なし（ユーザーには見せない） |
| 5 | ネットワークエラーで翌日引き継ぎ取得失敗 | 通信障害 | 空欄で表示し、「再読み込み」ボタンを表示 | 「データの取得に失敗しました。再読み込みしてください。」 |
| 6 | 必須バリデーションエラー | いずれかのセクション空欄 | 送信ボタン押下時にエラー表示、該当セクションをハイライト | 「未入力の項目があります。全ての項目を入力してください。」 |

---

## 8. 非機能要件

| No | カテゴリ | 要件 | 基準値 |
|----|----------|------|--------|
| 1 | パフォーマンス | ページ読み込み時間 | 5秒以内 |
| 2 | パフォーマンス | 翌日引き継ぎデータ取得時間 | 3秒以内 |
| 3 | パフォーマンス | Slack送信完了時間 | 3秒以内 |
| 4 | 可用性 | GAS実行時間 | 6分以内（GAS制限） |
| 5 | セキュリティ | 保存データ | 氏名以外の個人情報を保存しない |
| 6 | 互換性 | 既存機能 | 現行MVPの全機能を維持 |
| 7 | 保守性 | コード | 現行MVPのコード構造を踏襲 |

---

## 9. データ要件

### 9.1 保存が必要なデータ

| データ | 保存先 | 保存形式 | 保存タイミング | 保存期間 |
|--------|--------|----------|----------------|----------|
| 「次すること」の内容 | Script Properties（UserProperties） | JSON文字列 | Slack送信成功時 | 翌日の日報送信まで |

### 9.2 保存データの形式

```json
{
  "date": "2026-01-24",
  "nextTasks": "⚫︎ タスク1\n⚫︎ タスク2\n⚫︎ タスク3"
}
```

**キー名**: `NEXT_TASKS_DATA`

### 9.3 取得が必要なデータ

| データ | 取得元 | 取得方法 | 取得タイミング |
|--------|--------|----------|----------------|
| ユーザー氏名 | Googleアカウント | 1. Session.getActiveUser().getEmail()でメール取得 → @前を表示名に | ページ読み込み時 |
| 今日の日付 | システム日時 | Utilities.formatDate(new Date(), 'Asia/Tokyo', 'yyyy年MM月dd日') | ページ読み込み時 |
| 前日の「次すること」 | Script Properties | PropertiesService.getUserProperties().getProperty('NEXT_TASKS_DATA') | ページ読み込み時 |
| カレンダー予定 | Google Calendar API | 現行MVPと同じ | 「今日の予定を取得」ボタン押下時 |

### 9.4 氏名取得ロジック

```
1. Session.getActiveUser().getEmail() でメールアドレス取得
2. メールアドレスの @ より前の部分を抽出
   例: takagi.taro@example.com → takagi.taro
3. ドット(.)をスペースに置換し、各単語の先頭を大文字化
   例: takagi.taro → Takagi Taro
4. 取得できない場合は「名前を入力してください」を表示
```

---

## 10. 依存関係

| 依存先 | 内容 | 影響 |
|--------|------|------|
| V1（現行MVP） | カレンダー取得、Slack送信機能を継続利用 | V1が壊れるとV2も動かない |
| Google Apps Script | バックエンド実行環境 | GASの制限に従う |
| Google Account | 氏名取得 | 権限が必要 |
| Script Properties | データ保存 | 容量制限あり（500KB） |

---

## 11. 今回やらないこと（Won't）

| No | やらないこと | 理由 |
|----|--------------|------|
| 1 | 外部ツール連携（Slack履歴、Gmail等の自動取得） | V3以降で対応 |
| 2 | AIによる自動並べ替え | V6で対応 |
| 3 | 個人最適化（ツールON/OFF、自動学習） | V7で対応 |
| 4 | 複数ユーザー対応 | スコープ外 |
| 5 | 過去の日報履歴の閲覧機能 | スコープ外 |
| 6 | 「次すること」の複数日引き継ぎ | 複雑化を避けるため1日のみ |

---

## 12. テスト観点

### 12.1 正常系テスト

| No | テスト項目 | 確認内容 |
|----|------------|----------|
| 1 | 新テンプレート表示 | 4セクションが正しく表示される |
| 2 | ヘッダー表示 | 日付と氏名が正しく表示される |
| 3 | 日付形式 | 「YYYY年MM月DD日」形式で表示される |
| 4 | カレンダー取得 | 「今日やったこと」にカレンダー予定が入る |
| 5 | 全セクション入力→送信 | 正常にSlack送信される |
| 6 | 翌日引き継ぎ | 前日の「次すること」が表示される |
| 7 | 引き継ぎ内容編集 | 引き継ぎされた内容を編集できる |
| 8 | コピー機能 | テンプレート形式でコピーされる |

### 12.2 異常系テスト

| No | テスト項目 | 確認内容 |
|----|------------|----------|
| 1 | 空欄セクションあり | エラーメッセージが表示される |
| 2 | 空白のみ入力 | バリデーションエラーになる |
| 3 | 初回利用（引き継ぎなし） | エラーにならず空欄で表示 |
| 4 | 氏名取得失敗 | フォールバック動作する |

---

## 13. 用語定義

| 用語 | 定義 |
|------|------|
| セクション | 日報テンプレート内の各入力ブロック（「今日やったこと」等） |
| 翌日引き継ぎ | 前日の「次すること」を翌日の日報に自動で表示する機能 |
| 必須バリデーション | 全セクションに1文字以上の入力がないと送信できないチェック（空白のみは不可） |
| フォールバック | 主処理が失敗した場合の代替処理 |

---

## 改定履歴

| バージョン | 日付 | 内容 |
|------------|------|------|
| 1.0 | 2026-01-24 | 60点版 初版作成 |
| 2.0 | 2026-01-24 | 100点版（1回目）：曖昧表現の解消、エラーメッセージ追加、データ形式明記 |
| 3.0 | 2026-01-24 | 最終100点版：ワイヤーフレーム追加、バリデーション詳細化、氏名取得ロジック追加、テスト観点追加 |
