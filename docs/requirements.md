# 簡単日報くん - 統合要件定義書

## ドキュメント情報

| 項目 | 内容 |
|------|------|
| 文書名 | 簡単日報くん 統合要件定義書 |
| バージョン | 2.0 |
| 作成日 | 2026-02-08 |
| 最終更新日 | 2026-02-08 |
| 統合元 | docs/plan.md、docs/specs/V2〜V7要件定義書・仕様書 |

---

## 1. 機能要件

### 1.1 MVP/V1 - 基本機能

#### 1.1.1 カレンダー予定の取得

**対象日**: スクリプト実行時の日付（システム日時基準）

**取得条件**:
- プライマリカレンダー（`primary`）から取得
- 実行当日の0時00分〜23時59分の予定を取得
- 終日イベントも含む
- 削除済みイベントは除外
- キャンセル済みイベントは除外

**取得データ**:
- 予定タイトル
- 開始時刻
- 終了時刻
- 終日フラグ

**表示形式**:
- 通常イベント：「・[予定タイトル] [開始時刻]-[終了時刻]」（例：「・顧客訪問 10:00-11:00」）
- 終日イベント：「・[予定タイトル]（終日）」（例：「・出張（終日）」）
- 時刻の表示形式：HH:mm（24時間表記）
- ソート順：開始時刻の昇順

#### 1.1.2 データの表示・編集

- WEBブラウザ上にテキストエリアで表示
- 編集可能なテキストエリア
- 複数行の編集が可能
- 改行が保持される

#### 1.1.3 コピー機能

- 「コピー」ボタンをクリック
- クリップボードAPIを使用してテキストをコピー
- コピー成功時にメッセージを表示

#### 1.1.4 Slack送信

**送信処理フロー**:
1. テキストエリアの内容を取得
2. Slackチャンネル名を取得（入力または選択）
3. Webhook URLを取得（スクリプトプロパティまたは設定画面）
4. Slack投稿本文を生成
5. Slack Incoming Webhook APIにPOSTリクエストを送信
6. 送信成功時に成功メッセージを表示
7. 送信失敗時にエラーメッセージを表示

**Slack投稿フォーマット**:
```
【日報】YYYY/MM/DD

■ 本日のスケジュール
・顧客訪問 10:00-11:00
・会議 14:00-15:00
```

#### 1.1.5 エラーハンドリング

| エラーコード | エラーメッセージ | 発生タイミング |
|------------|----------------|--------------|
| ERR_CALENDAR_PERMISSION | エラー：カレンダーへのアクセス権限がありません。権限を確認してください。 | カレンダー取得時 |
| ERR_CALENDAR_FETCH | エラー：カレンダーから予定を取得できませんでした。しばらく時間をおいてから再度お試しください。 | カレンダー取得時 |
| ERR_WEBHOOK_URL_MISSING | エラー：Slack Webhook URLが設定されていません。設定を確認してください。 | Slack送信時 |
| ERR_WEBHOOK_URL_INVALID | エラー：Slack Webhook URLが無効です。設定を確認してください。 | Slack送信時 |
| ERR_CHANNEL_INVALID | エラー：チャンネル名が無効です。#から始まる形式で入力してください。 | Slack送信時 |
| ERR_SLACK_SEND_FAILED | エラー：Slackへの送信に失敗しました。ネットワーク接続を確認してください。 | Slack送信時 |
| ERR_UNEXPECTED | エラー：予期しないエラーが発生しました。詳細：[エラー内容] | 任意 |

### 1.2 V2 - テンプレート変更＋入力欄追加＋翌日引き継ぎ

#### 1.2.1 新テンプレート

```
【YYYY年MM月DD日　氏名　日報】

【今日やったこと】
⚫︎
⚫︎
⚫︎

【わかった事・問題・共有事項】
⚫︎
⚫︎
⚫︎

【売上・利益に関わるポイント】
⚫︎
⚫︎
⚫︎

【次すること】
⚫︎
⚫︎
⚫︎
```

#### 1.2.2 各セクションの役割

| セクション | 役割 | 入力者 | 必須 | 初期値 |
|------------|------|:------:|:----:|--------|
| 今日やったこと | 実際に行った作業の記録 | カレンダー自動＋人 | Yes | カレンダー予定 |
| わかった事・問題・共有事項 | 気づき・問題の早期発見 | 人 | Yes | 空欄 |
| 売上・利益に関わるポイント | 経営に関わる情報の共有 | 人 | Yes | 空欄 |
| 次すること | 翌日以降のタスク | 人 | Yes | 前日の「次すること」（あれば） |

#### 1.2.3 主要機能

| No | 機能ID | 機能名 | 概要 |
|----|--------|--------|------|
| 1 | F1 | 新テンプレート適用 | 4セクション構成に変更 |
| 2 | F2 | 氏名の自動取得 | Googleアカウントから取得 |
| 3 | F3 | 日付形式変更 | 「YYYY年MM月DD日」形式に変更 |
| 4 | F4 | 必須バリデーション | 各セクション1文字以上で送信可（空白のみは不可） |
| 5 | D1 | 「次すること」翌日引き継ぎ | 翌日の日報に自動反映 |

#### 1.2.4 翌日引き継ぎデータ

| データ | 保存先 | 保存形式 | 保存タイミング | キー名 |
|--------|--------|----------|----------------|--------|
| 「次すること」の内容 | Script Properties（UserProperties） | JSON文字列 | Slack送信成功時 | `NEXT_TASKS_DATA` |

**保存データの形式**:
```json
{
  "date": "2026-01-24",
  "nextTasks": "⚫︎ タスク1\n⚫︎ タスク2\n⚫︎ タスク3"
}
```

### 1.3 V3 - ツール連携①（Slack/Gmail/Notion）

各ツールの履歴を自動取得して「今日やったこと」に追加表示する。

| No | ツール | 取得内容 | API | 必要な設定 |
|----|--------|----------|-----|------------|
| 1 | Slack | 自分が投稿したメッセージ | Slack Web API | 追加スコープ（users:read, conversations.history:read） |
| 2 | Gmail | 送信したメール | Gmail API | OAuth 2.0スコープ（gmail.readonly） |
| 3 | Notion | 更新したページ | Notion API | Notion Integration Token |

### 1.4 V4 - ツール連携②（Docs/Drive/Dropbox）

ファイル操作履歴を自動取得する。

| No | ツール | 取得内容 | API | 必要な設定 |
|----|--------|----------|-----|------------|
| 1 | Google Docs | 編集したドキュメント | Google Drive API | OAuth 2.0スコープ（drive.readonly） |
| 2 | Google Drive | アップロード・変更したファイル | Google Drive API | OAuth 2.0スコープ（drive.readonly） |
| 3 | Dropbox | アップロード・変更したファイル | Dropbox API | Dropbox Access Token |

### 1.5 V5 - ツール連携③（Zoom/Meet/社内ツール）

会議参加履歴を自動取得する。

| No | ツール | 取得内容 | API | 必要な設定 |
|----|--------|----------|-----|------------|
| 1 | Zoom | 参加した会議 | Zoom API | Zoom OAuth App、JWT Token |
| 2 | Google Meet | 参加した会議 | Google Calendar API（会議情報） | OAuth 2.0スコープ（calendar.readonly） |
| 3 | 社内ツール | 利用履歴 | カスタムAPI | APIエンドポイント、認証情報 |

### 1.6 V6 - AIによる自動処理

| No | 機能ID | 機能名 | 概要 |
|----|--------|--------|------|
| 1 | AI1 | 重要度順並べ替え | OpenAI APIで各項目の重要度を判定し、スコアリング |
| 2 | AI2 | 最大10件絞り込み | スコア上位10件のみ表示 |
| 3 | UI1 | 削除・編集UI | 各項目に削除ボタン、編集ボタンを追加 |

必要な設定: OpenAI API Key

### 1.7 V7 - 個人最適化

| No | 機能ID | 機能名 | 概要 |
|----|--------|--------|------|
| 1 | PREF1 | ツールON/OFF設定 | 各ツール連携を個別にON/OFFできる設定画面 |
| 2 | PREF2 | よく使う順の自動学習 | 使用頻度をカウントし、次回から使用頻度順に表示 |

データ保存先: Script Properties（UserProperties）、JSON文字列形式

---

## 2. 非機能要件

| No | カテゴリ | 要件 | 基準値 |
|----|----------|------|--------|
| 1 | パフォーマンス | カレンダー予定取得時間 | 5秒以内 |
| 2 | パフォーマンス | Slack送信完了時間 | 3秒以内 |
| 3 | 可用性 | GAS実行時間 | 6分以内（GAS制限） |
| 4 | セキュリティ | Webhook URL | スクリプトプロパティに保存（コードに直接書かない） |
| 5 | セキュリティ | 保存データ | 氏名以外の個人情報を保存しない |
| 6 | 互換性 | 既存機能 | 前バージョンの全機能を維持 |
| 7 | 保守性 | コード | 既存コード構造を踏襲 |
| 8 | 環境 | ブラウザ | Chrome（推奨）、Firefox、Safari、Edge |
| 9 | 環境 | アカウント | Googleアカウント必須 |

### 2.1 技術的制約

- GASの実行時間制限：6分（無料版）
- GASの実行回数制限：1日あたり20,000回（無料版）
- Calendar APIの利用制限：1秒あたり250クエリ
- Slack Webhookの送信制限：1秒あたり1リクエスト（推奨）
- HTMLサービスはサーバーサイドで実行される（クライアント側のJavaScript制限あり）

### 2.2 データ制約

- カレンダー予定データのみを使用（KPIデータは使用しない）
- データはセッション内でのみ保持（ページを閉じると消える）
- 過去のデータは保存されない（毎回カレンダーから取得）

### 2.3 運用制約

- 当日のカレンダー予定のみ取得対象
- ブラウザを閉じると編集内容は失われる
- 送信済みのデータは履歴に残らない

---

## 3. やらないこと（スコープ外）

### 3.1 MVPでやらないこと

1. KPIデータの取得・表示
2. データの永続化（スプレッドシート等への保存）
3. 過去のデータの履歴管理
4. 複数カレンダーの統合
5. カレンダーのカテゴリ分け
6. スケジュールの詳細情報（場所・説明等）の表示
7. 画像・ファイルの添付
8. 日報のテンプレートカスタマイズ
9. 日報のエクスポート機能（PDF、Excel等）
10. 日報の印刷機能
11. 複数ユーザー対応
12. 日報の承認ワークフロー
13. 日報のコメント機能
14. 自動送信機能（スケジュール実行）
15. モバイルアプリ版

### 3.2 V2でやらないこと

| No | やらないこと | 理由 |
|----|--------------|------|
| 1 | 外部ツール連携（Slack履歴、Gmail等の自動取得） | V3以降で対応 |
| 2 | AIによる自動並べ替え | V6で対応 |
| 3 | 個人最適化（ツールON/OFF、自動学習） | V7で対応 |
| 4 | 複数ユーザー対応 | スコープ外 |
| 5 | 過去の日報履歴の閲覧機能 | スコープ外 |
| 6 | 「次すること」の複数日引き継ぎ | 複雑化を避けるため1日のみ |

---

## 4. 受け入れ条件・NG例

### 4.1 MVP/V1 受け入れ条件

| No | 受け入れ条件 |
|----|------------|
| 1 | GAS WEBアプリとしてデプロイでき、ブラウザからアクセスでき、正常に画面が表示される |
| 2 | プライマリカレンダーから当日の予定を取得でき、0件でも正常処理、終日イベントが正しく表示、開始時刻昇順 |
| 3 | 取得した予定データがテキストエリアに正しいフォーマットで表示される |
| 4 | テキストエリアでデータを編集でき、編集内容が反映される |
| 5 | 「コピー」ボタンでテキストエリアの内容をコピーでき、コピー成功メッセージが表示される |
| 6 | 正しいフォーマットで投稿本文が生成され、日付（YYYY/MM/DD）とテキストエリアの内容が含まれる |
| 7 | Webhook URLを設定するとSlackに送信でき、チャンネル名を指定でき、送信成功メッセージが表示される |
| 8 | カレンダーアクセス権限なし時・Webhook URL未設定時にエラーメッセージが表示され、処理が中断される |
| 9 | スクリプトプロパティにWebhook URLを設定・読み込みできる |
| 10 | ボタンがクリックでき、テキストエリアが編集でき、メッセージが表示される |

### 4.2 V2 受け入れ条件

| No | 受け入れ条件 | 確認方法 |
|----|------------|----------|
| 1 | 新テンプレート（4セクション構成）で日報が表示される | 画面確認 |
| 2 | ヘッダーに「日付」と「氏名」が自動で入る | 画面確認 |
| 3 | 日付形式が「YYYY年MM月DD日」になっている | 画面確認 |
| 4 | 氏名がGoogleアカウントから自動取得される | 画面確認 |
| 5 | いずれかのセクションが空欄の場合、エラーメッセージが表示される | 送信ボタン押下で確認 |
| 6 | 全セクションに1文字以上入力があれば送信可能 | 送信ボタン押下で確認 |
| 7 | 「次すること」の内容が翌日の日報に自動で表示される | 翌日アクセスで確認 |
| 8 | 翌日引き継ぎされた内容は編集・削除が可能 | 画面操作で確認 |
| 9 | 既存機能（カレンダー取得、コピー、Slack送信）が正常に動作する | 既存テストで確認 |
| 10 | Slack投稿が新テンプレート形式で送信される | Slack画面で確認 |

### 4.3 MVP/V1 NG例

| No | NG例 |
|----|------|
| 1 | カレンダー予定が取得できないのにエラーなく処理が継続する |
| 2 | カレンダーアクセス権限なしでエラーが表示されない |
| 3 | テキストエリアが編集できない |
| 4 | コピーボタンが動作しない |
| 5 | Slack送信時にWebhook URLが未設定でもエラーが表示されない |
| 6 | チャンネル名の形式が不正でも送信できてしまう |
| 7 | 送信失敗時にエラーが表示されない |
| 8 | エラーメッセージが分かりにくい（技術的なメッセージのみ） |
| 9 | 終日イベントが通常イベントと同じ形式で表示される |
| 10 | 予定のソート順が不定（開始時刻の昇順でない） |
| 11 | ブラウザを閉じた後に編集内容が残ってしまう（データ永続化は不要） |

### 4.4 V2 NG例

| No | NG例 | 理由 |
|----|------|------|
| 1 | いずれかのセクションが空欄でSlack送信できてしまう | 必須バリデーションが機能していない |
| 2 | 氏名が空欄または「undefined」で表示される | 自動取得が失敗している |
| 3 | 日付が「2026/01/24」形式で表示される | 形式変更が適用されていない |
| 4 | 「次すること」が翌日に引き継がれない | 翌日引き継ぎ機能が動作していない |
| 5 | 翌日引き継ぎされた内容が編集できない | UI上の問題 |
| 6 | 既存のカレンダー取得機能が動かなくなる | 既存機能への影響 |
| 7 | Slack投稿の形式が崩れる | テンプレート変更の影響 |
| 8 | 空白文字のみでバリデーションを通過してしまう | トリム処理の不足 |

---

## 5. 依存関係

### 5.1 バージョン間依存

| 依存先 | 内容 | 影響 |
|--------|------|------|
| V1（現行MVP） | カレンダー取得、Slack送信機能を継続利用 | V1が壊れるとV2以降も動かない |
| V2 | 新テンプレート、4セクション構成を継続利用 | V2が壊れるとV3以降も動かない |

### 5.2 外部サービス依存

| 依存先 | 内容 | 影響 |
|--------|------|------|
| Google Apps Script | バックエンド実行環境 | GASの制限に従う |
| Google Account | 氏名取得 | 権限が必要 |
| Script Properties | データ保存 | 容量制限あり（500KB） |
| Google Calendar API | 予定取得 | API制限に従う |
| Slack Webhook API | 日報送信 | Webhook URL必須 |

---

## 6. 用語定義

| 用語 | 定義 |
|------|------|
| GAS | Google Apps Scriptの略。Googleサービスを自動化するスクリプト |
| HTMLサービス | GASが提供するWEBアプリ構築機能 |
| Webhook | アプリケーション間でイベントを通知する仕組み |
| プライマリカレンダー | Googleアカウントのデフォルトカレンダー（calendarId: 'primary'） |
| 終日イベント | 開始時刻と終了時刻が設定されていない、1日全体のイベント |
| スクリプトプロパティ | GASで設定値を安全に保存する機能 |
| MVP | Minimum Viable Product（最小実行可能製品）の略 |
| セクション | 日報テンプレート内の各入力ブロック（「今日やったこと」等） |
| 翌日引き継ぎ | 前日の「次すること」を翌日の日報に自動で表示する機能 |
| 必須バリデーション | 全セクションに1文字以上の入力がないと送信できないチェック（空白のみは不可） |

---

以上
